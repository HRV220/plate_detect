Сервис анонимизации номерных знаков v2.0

Продакшен-готовый сервис на FastAPI, который обрабатывает изображения "на лету", находит на них автомобильные номера и возвращает результат в виде ZIP-архива.

# Основные возможности

- Обработка "на лету": Принимает пачку изображений в одном запросе и возвращает результат, не требуя проверки статуса.

- Потоковая передача: ZIP-архив с результатами отдается клиенту потоком (StreamingResponse), что экономит память сервера и ускоряет ответ.

- Пакетная обработка: Эффективная обработка множества изображений за один запрос для максимальной производительности ML-модели.

- Высокая производительность: Использует YOLOv8 для точной детекции и оптимизирован для работы как на CPU, так и на GPU.

- Готовность к продакшену: Упакован в Docker-контейнер, использует Gunicorn, имеет централизованную конфигурацию, полное логирование и обработку ошибок.

- Автоматическая документация: Интерактивная документация API всегда доступна через Swagger UI (/docs) и ReDoc (/redoc).

# Технологический стек

- Бэкенд: Python 3.10, FastAPI

- ML/CV: PyTorch, YOLOv8, OpenCV, Pillow

- Сервер: Gunicorn + Uvicorn

- Контейнеризация: Docker

# Установка и запуск

Проект полностью контейнеризирован, что делает его запуск быстрым и воспроизводимым на любой системе.

Пререквизиты

- Git

- Docker

1. Подготовка проекта

```bash

# Клонируем репозиторий
git clone https://github.com/HRV220/plate_detect.git

# Переходим в директорию сервиса
cd plate_detect/server/

```

2. Сборка и запуск Docker-контейнера

Эти команды соберут образ приложения и запустят его в фоновом режиме.

```bash

# 1. Собрать Docker-образ

docker build -t plate-cover-service .

# 2. Запустить контейнер

docker run -d -p 8000:8000 --name plate-cover-container plate-cover-service
```

3. Проверка статуса

```bash

# Просмотр логов в реальном времени
docker logs -f plate-cover-container
```

Если вы видите сообщения от Gunicorn о запуске воркеров, значит, все прошло успешно.
Сервис доступен по адресу http://localhost:8000.

Локальная разработка (без Docker)

Для внесения изменений в код удобно запускать сервис локально.

Создайте виртуальное окружение (требуется Python 3.10+):

```bash
python -m venv venv
source venv/bin/activate # Для Windows: venv\Scripts\activate
```

Установите зависимости:

```bash
pip install -r requirements.txt
```

Запустите сервер для разработки:

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

# Использование API

Полная интерактивная документация с возможностью отправки тестовых запросов доступна по адресу:
http://localhost:8000/docs

Обработка изображений

Эндпоинт: POST /api/v1/process-images/

Принимает на вход один или несколько файлов изображений и возвращает ZIP-архив с обработанными версиями.

Запрос:

Тип: multipart/form-data

Поле: files (может быть указано несколько раз для разных файлов)

Ответ (успех 200 OK):

Тип: application/zip

Описание: Тело ответа содержит бинарные данные ZIP-архива.

# Пример использования (cURL)

Эта команда отправит два изображения на обработку и сохранит полученный ZIP-архив в файл result.zip.

```bash
curl -X POST "http://localhost:8000/api/v1/process-images/" \
 -F "files=@/path/to/your/image1.jpg" \
 -F "files=@/path/to/your/image2.png" \
 -o result.zip
```

Флаг -o result.zip указывает cURL сохранить тело ответа в файл.

# Служебные эндпоинты

GET /: Редирект на /docs.

GET /docs: Интерактивная документация Swagger UI.

GET /redoc: Альтернативная документация ReDoc.

GET /health: Эндпоинт для проверки работоспособности сервиса. Возвращает {"status": "ok"}.

# Конфигурация

Поведение сервиса можно настраивать через переменные окружения при запуске Docker-контейнера.

Переменная Описание По умолчанию Пример
PROCESSING_DEVICE Устройство для вычислений ML-модели cpu -e PROCESSING_DEVICE=cuda
GUNICORN_WORKERS Количество рабочих процессов Gunicorn 4 -e GUNICORN_WORKERS=8
JPEG_QUALITY Качество сжатия итоговых JPEG-изображений 95 -e JPEG_QUALITY=85

Пример запуска с кастомной конфигурацией:

```bash
docker run -d -p 8000:8000 \
 -e PROCESSING_DEVICE=cuda \
 -e GUNICORN_WORKERS=2 \
 --name plate-cover-container \
 plate-cover-service
```
